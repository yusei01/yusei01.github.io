<html lang="ja">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<title>Spoken Dialog by Javascript</title>
</head>
<body>


<p>
<button id="startButton">éŸ³å£°æ“ä½œ<b>ğŸ™</b></button>
</p>

<p>
<div id="resultOutput"></div>
</p>
<!DOCTYPE html> 
<html lang  ="ja">
    <head>
        <meta charset="UTF-8">
        <title>Best your chair</title>
        <link href="css/chair.css" type="text/css" rel="stylesheet">
    </head>
    
    <body>
        <header>
            <h1>Best your chair</h1>
            <div class="eye">
                <img src="images/eye_catch.png" alt="ã‚¢ã‚¤ã‚­ãƒ£ãƒƒãƒç”»åƒ">
            </div>
        </header>
        
        <main>
           <div class="gaiyo">
                <img src="images/gaiyo_kuro.jpg" alt="ä¼šç¤¾æ¦‚è¦">
           </div>
           <div class="gaiyo">
                <img src="images/rinen_shiro.jpg" alt="ç¤¾é•·ç†å¿µ">
           </div>
           <div class="gaiyo">
               <a href="test2.html">
                   <img src="images/product.png" alt="è£½å“">
                </a>
            </div>
        
        </main>
    </body>

<script>
// å¿œç­”ã®å®šç¾©ï¼ˆãƒãƒƒã‚·ãƒ¥ï¼‰    
var response = {
    "ã‚ãŒç¤¾ã®è£½å“": ["ã€Œã‚ãŒç¤¾ã®è£½å“ã€ã‚’è¡¨ç¤ºã—ã¾ã™", "test2.html"],
    "ä¼šç¤¾æ¦‚è¦": ["ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚åªä»Šã€é–²è¦§ä¸å¯èƒ½ã§ã™ã€‚"],
    "ç¤¾é•·ç†å¿µ": ["ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚åªä»Šã€é–²è¦§ä¸å¯èƒ½ã§ã™ã€‚"],
    "ãƒ›ãƒ¼ãƒ ": ["ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ãŒã€ãƒ›ãƒ¼ãƒ ã§ã™ã€‚"],
    "å…µåº«ã®å¤©æ°—": ["å…µåº«çœŒã®å¤©æ°—äºˆå ±ã‚’è¡¨ç¤ºã—ã¾ã™", "https://weather.yahoo.co.jp/weather/jp/28/"]
};

const startButton = document.querySelector('#startButton'); // é–‹å§‹ãƒœã‚¿ãƒ³
const stopButton = document.querySelector('#stopButton'); // åœæ­¢ãƒœã‚¿ãƒ³
const resultOutput = document.querySelector('#resultOutput'); // çµæœå‡ºåŠ›ã‚¨ãƒªã‚¢

if (!'SpeechSynthesisUtterance' in window) {
    alert("ã‚ãªãŸã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯Speech Synthesis APIã«æœªå¯¾å¿œã§ã™ã€‚");
}
const tts = new SpeechSynthesisUtterance(); // TTSã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆ
//tts.text = textForm.value; // ãƒ†ã‚­ã‚¹ãƒˆã‚’è¨­å®š
tts.lang = "ja-JP"; // è¨€èª(æ—¥æœ¬èª)ã€è‹±èªã®å ´åˆã¯en-US
tts.rate = 1.0; // é€Ÿåº¦
tts.pitch = 1.0; // å£°ã®é«˜ã•
tts.volume = 1.0; // éŸ³é‡

SpeechRecognition = webkitSpeechRecognition || SpeechRecognition;
if (!'SpeechRecognition' in window) {
    alert("ã‚ãªãŸã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯Speech Recognition APIã«æœªå¯¾å¿œã§ã™ã€‚");
}

const asr = new SpeechRecognition(); // ASRã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆ
asr.lang = "ja-JP"; // è¨€èªï¼ˆæ—¥æœ¬èªï¼‰
asr.interimResults = true; // é€”ä¸­çµæœå‡ºåŠ›ã‚’ã‚ªãƒ³
asr.continuous = true; // ç¶™ç¶šå…¥åŠ›ã‚’ã‚ªãƒ³

let output = ''; // å‡ºåŠ›

// èªè­˜çµæœãŒå‡ºåŠ›ã•ã‚ŒãŸã¨ãã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
asr.onresult = function(event){
    let transcript = event.results[event.resultIndex][0].transcript; // çµæœæ–‡å­—åˆ—

    let output_not_final = '';
    if (event.results[event.resultIndex].isFinal) { // çµæœãŒç¢ºå®šï¼ˆFinalï¼‰ã®ã¨ã
	    asr.abort(); // éŸ³å£°èªè­˜ã‚’åœæ­¢
	    let ret = response[transcript];

        let answer;
        let webpage;
        
        if(typeof ret == 'undefined'){
	        answer = "ã”ã‚ã‚“ãªã•ã„ã€‚ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚";
    	}else if(typeof ret[1] == 'undefined'){
            answer = ret[0];
        }
        
        else{
            answer = ret[0];
            webpage = ret[1];
        }

        output += transcript + ' => ' + answer + '<br>';

	    tts.text = answer;
	    // å†ç”ŸãŒçµ‚äº†ï¼ˆendï¼‰ã¨ãã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ï¼ˆçµ‚äº†ã—ãŸã¨ãã«å®Ÿè¡Œã•ã‚Œã‚‹ï¼‰
	    tts.onend = function(event){
            if(typeof webpage != 'undefined'){
                location.href = webpage; // ãƒšãƒ¼ã‚¸ã‚’ç§»å‹•
            }   
            asr.start(); // éŸ³å£°èªè­˜ã‚’å†é–‹ 
	    }

	    speechSynthesis.speak(tts); // å†ç”Ÿ
    } else { // çµæœãŒã¾ã æœªç¢ºå®šã®ã¨ã
        output_not_final = '<span style="color:#ddd;">' + transcript + '</span>';
    }
    resultOutput.innerHTML = output + output_not_final;
}

// é–‹å§‹ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
startButton.addEventListener('click', function() {
    asr.start();
})

// åœæ­¢ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
stopButton.addEventListener('click', function() {
    asr.abort();
    asr.stop();
})
</script>

</body>
</html>
